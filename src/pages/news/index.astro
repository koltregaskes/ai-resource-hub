---
import BaseLayout from '../../layouts/BaseLayout.astro';
import NewsFilter from '../../components/NewsFilter';
import { getNews } from '../../db/queries';

const news = getNews(500);
const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;

// Serialize news items for the React component
const newsItems = news.map((item) => ({
  id: item.id,
  title: item.title,
  url: item.url,
  source: item.source,
  summary: item.summary,
  image_url: item.image_url,
  published_at: item.published_at,
  category: item.category,
}));
---

<BaseLayout
  title="AI News — The AI Resource Hub"
  description="Latest AI news — model releases, research breakthroughs, funding rounds, and industry updates. Filtered for the technical side of AI."
>
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    <nav class="text-xs text-(--color-text-muted) mb-4" aria-label="Breadcrumb">
      <a href={base} class="hover:text-(--color-text-secondary) transition-colors">Home</a>
      <span class="mx-2">/</span>
      <span class="text-(--color-text-secondary)">News</span>
    </nav>

    <div class="mb-8">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-(--color-text-primary) mb-3">
        AI News
      </h1>
      <p class="text-(--color-text-secondary) max-w-2xl">
        Latest AI news — model releases, research breakthroughs, open-source developments, and technical deep-dives. Updated daily.
      </p>
    </div>

    <NewsFilter client:load news={newsItems} baseUrl={base} />
  </section>
</BaseLayout>
