---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ModelComparisonTable from '../../components/ModelComparisonTable';
import { getModelsByCategory } from '../../db/queries';

const models = getModelsByCategory('speech');
const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
const lastUpdated = new Date().toLocaleDateString('en-GB', {
  day: 'numeric',
  month: 'short',
  year: 'numeric',
});

function formatPrice(v: unknown): string {
  const price = v as number;
  if (price === 0) return 'Free';
  return `$${price.toFixed(4)}`;
}

function formatDuration(v: unknown): string {
  const sec = v as number;
  if (sec >= 3600) return `${(sec / 3600).toFixed(1)}hr`;
  return `${Math.round(sec / 60)}min`;
}

function formatRTF(v: unknown): string {
  return `${v}x RT`;
}

const columns = [
  { field: 'name' as const, label: 'Model', shortLabel: 'Model', format: (v: unknown) => String(v), align: 'left' as const, defaultSort: 'asc' as const },
  { field: 'provider' as const, label: 'Provider', shortLabel: 'Provider', format: (v: unknown) => String(v), align: 'left' as const, defaultSort: 'asc' as const },
  { field: 'inputPrice' as const, label: 'Cost / Minute', shortLabel: '$/min', format: formatPrice, align: 'right' as const, defaultSort: 'asc' as const },
  { field: 'contextWindow' as const, label: 'Max Duration', shortLabel: 'Max Dur.', format: formatDuration, align: 'right' as const, defaultSort: 'desc' as const },
  { field: 'speed' as const, label: 'Speed', shortLabel: 'Speed', format: formatRTF, align: 'right' as const, defaultSort: 'desc' as const },
  { field: 'qualityScore' as const, label: 'Quality', shortLabel: 'Qual.', format: (v: unknown) => String(v), align: 'right' as const, defaultSort: 'desc' as const },
];

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'Dataset',
  name: 'AI Speech-to-Text Model Comparison',
  description: 'Independent comparison of AI speech recognition models — Whisper, AssemblyAI, Deepgram, and more.',
  url: new URL(`${base}compare/speech`, Astro.site).toString(),
};
---

<BaseLayout
  title="Speech-to-Text Comparison — The AI Resource Hub"
  description="Compare AI speech recognition models by price, accuracy, speed, and max duration. Whisper, AssemblyAI, Deepgram Nova, and more."
>
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    <div class="mb-8">
      <nav class="text-xs text-(--color-text-muted) mb-4" aria-label="Breadcrumb">
        <a href={base} class="hover:text-(--color-text-secondary) transition-colors">Home</a>
        <span class="mx-2">/</span>
        <span class="text-(--color-text-secondary)">Speech-to-Text Models</span>
      </nav>

      <h1 class="text-3xl sm:text-4xl font-extrabold text-(--color-text-primary) mb-3">
        AI Speech-to-Text Models
      </h1>
      <p class="text-(--color-text-secondary) max-w-2xl">
        Compare {models.length} speech recognition models across pricing, accuracy, processing speed,
        and maximum audio duration. Click any column header to sort.
      </p>
      <p class="text-xs text-(--color-text-muted) mt-2">
        Last updated: {lastUpdated} &middot; Prices per minute of audio
      </p>
    </div>

    <ModelComparisonTable
      client:load
      models={models}
      columns={columns}
      category="speech"
      baseUrl={base}
      priceLabel="Cost per minute of audio (USD)"
      priceUnit="standard tier"
    />
  </section>

  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
</BaseLayout>
